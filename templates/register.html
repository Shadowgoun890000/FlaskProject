<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Administrador - Sistema de Turnos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .register-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .register-card {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 450px;
        }
        .password-strength {
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }
        .strength-weak { color: #e74c3c; }
        .strength-medium { color: #f39c12; }
        .strength-strong { color: #27ae60; }
        .code-help {
            background: #e8f4fd;
            padding: 0.75rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="register-container">
        <div class="register-card">
            <div class="header text-center">
                <h1>üë§ Crear Cuenta de Administrador</h1>
                <p>Registro para nuevo personal administrativo</p>
            </div>

            <!-- Mostrar mensajes flash -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}"
                             style="background: {% if category == 'error' %}#f8d7da{% else %}#d1ecf1{% endif %};
                                    color: {% if category == 'error' %}#721c24{% else %}#0c5460{% endif %};
                                    padding: 10px; border-radius: 4px; margin-bottom: 1rem;">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <div class="code-help">
                <strong>üìù Informaci√≥n importante:</strong><br>
                ‚Ä¢ Necesitas un c√≥digo de registro v√°lido<br>
                ‚Ä¢ Los c√≥digos son generados por administradores existentes<br>
                ‚Ä¢ Cada c√≥digo es v√°lido por 24 horas<br>
                ‚Ä¢ Contacta con un administrador para obtener un c√≥digo
            </div>

            <form id="registerForm" method="POST" action="{{ url_for('register_admin') }}">
                <div class="form-group">
                    <label for="registration_code">C√≥digo de Registro *</label>
                    <input type="text" id="registration_code" name="registration_code"
                           class="form-control" required placeholder="Ingresa el c√≥digo de registro"
                           pattern="[A-Z0-9]{16}" title="C√≥digo de 16 caracteres (letras may√∫sculas y n√∫meros)"
                           style="text-transform: uppercase;">
                    <small>El c√≥digo debe tener exactamente 16 caracteres (letras y n√∫meros)</small>
                </div>

                <div class="form-group">
                    <label for="nombre_completo">Nombre Completo *</label>
                    <input type="text" id="nombre_completo" name="nombre_completo"
                           class="form-control" required placeholder="Tu nombre completo">
                </div>

                <div class="form-group">
                    <label for="username">Usuario *</label>
                    <input type="text" id="username" name="username"
                           class="form-control" required placeholder="Nombre de usuario"
                           pattern="[a-zA-Z0-9_]{3,}" title="M√≠nimo 3 caracteres (solo letras, n√∫meros y _)">
                    <small>Solo letras, n√∫meros y guiones bajos. M√≠nimo 3 caracteres.</small>
                </div>

                <div class="form-group">
                    <label for="email">Correo Electr√≥nico *</label>
                    <input type="email" id="email" name="email"
                           class="form-control" required placeholder="tu@email.com">
                </div>

                <div class="form-group">
                    <label for="password">Contrase√±a *</label>
                    <input type="password" id="password" name="password"
                           class="form-control" required placeholder="M√≠nimo 6 caracteres"
                           minlength="6">
                    <div id="passwordStrength" class="password-strength"></div>
                </div>

                <div class="form-group">
                    <label for="confirm_password">Confirmar Contrase√±a *</label>
                    <input type="password" id="confirm_password" name="confirm_password"
                           class="form-control" required placeholder="Repite tu contrase√±a">
                    <div id="passwordMatch" class="password-strength"></div>
                </div>

                <button type="submit" class="btn btn-primary btn-block" id="submitBtn">
                    Crear Cuenta
                </button>
            </form>

            <div class="text-center mt-3">
                <p>¬øYa tienes cuenta?</p>
                <a href="{{ url_for('login') }}" class="btn btn-secondary">
                    üîê Iniciar Sesi√≥n
                </a>
            </div>

            <div class="text-center mt-2">
                <a href="{{ url_for('publico') }}" class="btn btn-outline">
                    üåê Volver al Sistema P√∫blico
                </a>
            </div>
        </div>
    </div>

    <script>
        // Convertir autom√°ticamente a may√∫sculas el c√≥digo de registro
        document.getElementById('registration_code').addEventListener('input', function(e) {
            this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
        });

        // Validaci√≥n de contrase√±a en tiempo real
        const passwordInput = document.getElementById('password');
        const confirmInput = document.getElementById('confirm_password');
        const strengthText = document.getElementById('passwordStrength');
        const matchText = document.getElementById('passwordMatch');
        const submitBtn = document.getElementById('submitBtn');

        function checkPasswordStrength(password) {
            if (password.length === 0) {
                return { strength: 0, text: '' };
            } else if (password.length < 6) {
                return { strength: 1, text: 'Muy d√©bil - M√≠nimo 6 caracteres', class: 'strength-weak' };
            } else if (password.length < 8) {
                return { strength: 2, text: 'D√©bil', class: 'strength-weak' };
            } else if (password.length < 10) {
                return { strength: 3, text: 'Media', class: 'strength-medium' };
            } else {
                return { strength: 4, text: 'Fuerte', class: 'strength-strong' };
            }
        }

        function checkPasswordMatch() {
            const password = passwordInput.value;
            const confirm = confirmInput.value;

            if (confirm.length === 0) {
                matchText.textContent = '';
                matchText.className = 'password-strength';
            } else if (password === confirm) {
                matchText.textContent = '‚úÖ Las contrase√±as coinciden';
                matchText.className = 'password-strength strength-strong';
            } else {
                matchText.textContent = '‚ùå Las contrase√±as no coinciden';
                matchText.className = 'password-strength strength-weak';
            }
        }

        passwordInput.addEventListener('input', function() {
            const result = checkPasswordStrength(this.value);
            strengthText.textContent = result.text;
            strengthText.className = 'password-strength ' + result.class;
            checkPasswordMatch();
        });

        confirmInput.addEventListener('input', checkPasswordMatch);

        // Validaci√≥n del formulario
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            const registrationCode = document.getElementById('registration_code').value;
            const password = passwordInput.value;
            const confirm = confirmInput.value;

            // Validar c√≥digo de registro
            if (registrationCode.length !== 16) {
                e.preventDefault();
                alert('El c√≥digo de registro debe tener exactamente 16 caracteres');
                return;
            }

            if (!/^[A-Z0-9]{16}$/.test(registrationCode)) {
                e.preventDefault();
                alert('El c√≥digo de registro solo puede contener letras may√∫sculas y n√∫meros');
                return;
            }

            if (password !== confirm) {
                e.preventDefault();
                alert('Las contrase√±as no coinciden');
                return;
            }

            if (password.length < 6) {
                e.preventDefault();
                alert('La contrase√±a debe tener al menos 6 caracteres');
                return;
            }

            // Mostrar loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="spinner"></div> Creando cuenta...';
        });
    </script>
</body>
</html>